type Vector

new_vector : (SysState, U32) -> R (SysState, Vector) SysState
free_vector : (SysState, Vector) -> SysState

type VectorUsed
type VectorFree

type FocusVectorFArg a b = #{uvec : VectorUsed, fvec : VectorFree, acc : a, obsv : b}
type FocusVectorFRet r   = #{uvec : VectorUsed, fvec : VectorFree, res : r}

type FocusVectorRoFArg a b = #{uvec : VectorUsed!, fvec : VectorFree!, acc : a, obsv : b}
type FocusVectorRoFRet r   = #{uvec : VectorUsed!, fvec : VectorFree!, res : r}

focus_vector : all (a :< E, b :< DS, r :< E).
               #{ vec : Vector
                , acc : a
                , obsv : b
                , f : FocusVectorFArg a b -> FocusVectorFRet r
                } -> (r, Vector)

focus_vector_ro : all (a :< E, b :< DS, r :< E).
                  #{ vec : Vector!
                   , acc : a
                   , obsv : b
                   , f : FocusVectorRoFArg a b -> FocusVectorRoFRet r
                   } -> r

vector_next : (VectorUsed, VectorFree!) -> <This VectorUsed | Next VectorUsed>
vector_next_ro : (VectorUsed!, VectorFree!) -> <NoMore | Next (VectorUsed!)>


vector_loop : all (a :< E, b :< DS).
              #{uvec : VectorUsed, fvec : VectorFree, acc : a, obsv : b}
           -> #{uvec : VectorUsed, fvec : VectorFree, acc : a}

vector_del : all t. #{uvec : VectorUsed, fvec : VectorFree, f : t! -> Bool}
                 -> #{uvec : VectorUsed, fvec : VectorFree}

vector_read : all t. VectorUsed! -> t!

vector_idx : all (t, a :< E, b :< DS, r :< E).
             #{ uvec : VectorUsed!
              , idx : U32
              , acc : a
              , obsv : b
              , f : #{elem : t!, acc : a, obsv : b} -> r
              } -> (VectorUsed!, r)

vector_append : all t. #{uvec : VectorUsed, fvec : VectorFree, obj : t!}
                    -> #{suc : Bool, uvec : VectorUsed, fvec : VectorFree}

